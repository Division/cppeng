//
// Created by Sidorenko Nikita on 4/3/18.
//

#include "catch.hpp"
#include "../src/scene/Scene.h"
#include "../src/EngMath.h"
#include "../src/system/Logging.h"

TEST_CASE( "Camera and transform" ) {
  auto scene = new Scene();
  scene->setAsDefault();

  auto camera1 = CreateGameObject<Camera>();
  REQUIRE(scene->cameraCount() == 1);
  auto camera2 = CreateGameObject<Camera>();
  auto camera3 = CreateGameObject<Camera>();
  REQUIRE(scene->cameraCount() == 3);

  camera3->transform()->parent(camera2->transform());

  DestroyGameObject(camera1);
  REQUIRE(scene->cameraCount() == 2);
  REQUIRE(scene->gameObjects()->size() == 2);
  DestroyGameObject(camera2);

  REQUIRE(scene->cameraCount() == 0);
  REQUIRE(scene->gameObjects()->size() == 0);

  //

  camera1 = CreateGameObject<Camera>();
  REQUIRE(scene->cameraCount() == 1);
  camera2 = CreateGameObject<Camera>();
  camera3 = CreateGameObject<Camera>();
  REQUIRE(scene->cameraCount() == 3);

  camera2->transform()->parent(camera1->transform());
  camera3->transform()->parent(camera1->transform());
  auto children = camera1->transform()->children();
  DestroyGameObject(camera2);
  REQUIRE(children->size() == 1);
  REQUIRE(scene->gameObjects()->size() == 2);
  REQUIRE(scene->gameObjectMap()->size() == 2);
}
